#!/bin/sh
#
# edit a local website and reload surf when a file changes
#
# kento@okura.at

. /home/kento/bin/siteutils
local src_dir dst_dir name url

if [ -z "$*" ] ; then
	echo No arguments given, no folder named src or dst in current directory.
	echo using fallback falues:

	: "${src_dir:=${SITE_SRC_DIR:=src}}"
	: "${dst_dir:=${SITE_DST_DIR:=dst}}"
	: "${name:=${SITE_NAME:="Kentos Blog"}}"
	: "${url:=${SITE_URL:="okura.at"}}"   


cat <<EOF
looking for .md files in ${src_dir}
placing .html files in ${dst_dir}
site name will be "${name}"
site URL will be "${url}"
EOF

openfiles

trap deploy EXIT

find $src_dir | 
	entr -s "rm -f $src_dir/.files && ssg5 $src_dir $dst_dir $name $url && refreshsurf"
		#&& kill -HUP $(pgrep surf)"
	#entr -ps ". ~/bin/siteutils && generate $src_dir $dst_dir $name $url && refreshsurf"
